server {
  listen 80 default_server;
  listen [::]:80 default_server;

  server_name _;
  server_tokens off;

  add_header X-Frame-Options "SAMEORIGIN";
  add_header X-XSS-Protection "1; mode=block";
  add_header X-Content-Type-Options "nosniff";

  root /var/www/default/public;
  index index.php index.html;

  charset utf-8;

  # bots and curl users
  if ($http_user_agent = "") {
    return 403;
  }

  # if ($scheme = http) {
  #   return 301 https://$host$request_uri;
  # }

  location = /favicon.ico { access_log off; log_not_found off; }
  location = /robots.txt  { access_log off; log_not_found off; }
  location = /humans.txt  { access_log off; log_not_found off; }

  error_page 404 /index.php;

  location /nginx_status {
    stub_status on;
    access_log   off;
    allow 127.0.0.1;
    deny all;
  }

  location / {
    try_files $uri $uri/ /index.php$is_args$args;
  }

  location ~ \.php$ {
    include snippets/fastcgi-php.conf;
    fastcgi_param   APPLICATION_ENV  production;
    fastcgi_pass unix:/run/php/php7.0-fpm.sock;
  }

  location ~ /\.(?!well-known).* {
    deny all;
  }

  log_format  main_ext  '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for" '
                    '"$host" sn="$server_name" '
                    'rt=$request_time '
                    'ua="$upstream_addr" us="$upstream_status" '
                    'ut="$upstream_response_time" ul="$upstream_response_length" '
                    'cs=$upstream_cache_status' ;

  access_log /var/log/nginx/access.log main_ext;
  error_log /var/log/nginx/error.log warn;

}
